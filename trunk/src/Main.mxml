<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" paddingBottom="5" paddingTop="5" paddingLeft="5" paddingRight="5"
	width="100%" height="100%" 
	xmlns:view="org.planigle.planigle.view.*"
	xmlns:control="org.planigle.planigle.control.*"
	xmlns:business="org.planigle.planigle.business.*"
	applicationComplete="created(event)">

	<!--TODO: DEBUG HTTP REQUESTS:  Should be commented out for Production.-->
	<mx:TraceTarget/>

	<!--The main style sheet for all the applications.-->
	<mx:Style source="stylesheets/flex.css"/>
	
	<mx:Script>
		<![CDATA[
			import flash.external.ExternalInterface;
			import org.planigle.planigle.vo.LoginVO;
			import org.planigle.planigle.events.LoginEvent;
			import org.planigle.planigle.model.ViewModelLocator;

			// Hack to work around an issue with charts.  See http://gregjessup.com/flex-3-advanceddatagrid-cannot-convert-mxmanagersdragmanagerimpl-to-mxmanagersidragmanager/.
			import mx.managers.IDragManager; 
			private var iDragManager:IDragManager;  

			[Bindable]
			private var viewModelLocator:ViewModelLocator = ViewModelLocator.getInstance();			

			// Images to be leveraged by pages.
			[Embed(source="../public/images/edit.png")]
			[Bindable]
			public var imgEdit:Class;
			
			[Embed(source="../public/images/cross.png")]
			[Bindable]
			public var imgCross:Class;
		
			[Embed(source="../public/images/add.gif")]
			[Bindable]
			public var imgAdd:Class;
		
			[Embed(source="../public/images/export.png")]
			[Bindable]
			public var imgExport:Class;
			
			// See if a cookie is present which skips login.
			private function created(event:Event):void
			{
				if (ExternalInterface.available && containsCookie("auth_token"))
					new LoginEvent( new LoginVO('', '', true, false, true) ).dispatch();
				else
					viewModelLocator.workflowState = ViewModelLocator.LOGIN_SCREEN;
			}

			// Answer true if a cookie exists with the given name.
			private function containsCookie(cookie:String):Boolean
			{
				var js:String = "function get_cookie(){return document.cookie;}"
				return ExternalInterface.call(js).toString().indexOf(cookie + "=") != -1;
			}
		]]>
	</mx:Script>
	
	<!--Cairngorm FrontController and ServiceLocator inclusions.-->
	<control:SessionController id ="sessionController"/>
	<control:ReleasesController id ="releasesController"/>
	<control:IterationsController id ="iterationsController"/>
	<control:StoriesController id ="storiesController"/>
	<control:ProjectsController id ="projectsController"/>
	<control:IndividualsController id ="individualsController"/>
	<business:Services id="services"/>
	
	<mx:ViewStack id="mainViewStack" selectedIndex="{viewModelLocator.workflowState}" width="100%" height="100%">		
		<mx:Canvas/>				<!-- Show a blank screen by default -->
		<view:SignupScreen/>
		<view:LicenseAgreementScreen/>
		<view:LoginScreen/>		
		<view:CoreApplicationScreen name="core"/>
	</mx:ViewStack>
</mx:Application>